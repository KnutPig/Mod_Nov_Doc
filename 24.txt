
# Сценарий **Оформление и оплата заказа**

1. Клиент переходит в *Корзину*
2. В *Корзине* клиенту доступны следующие опции:
  * Очистить Корзину (удаление всех предвыбранных товарных позиций)
  * Список всех предвыбранных товарных позиций:
    - Описание 
    - Стоимость
    - Возможность увеличения/уменьшения количества по каждой товарной позиции
    - Добавление сопутствующих товарных позиций (карусель с возможно необходимыми товарами: соусы, салфетки, жвачка) - *получаем запросом из БД*
    - Окно для ввода промокода
    - Итоговая стоимость заказа - *при внесении изменения в структуре корзины отправляется дополнительный запрос на пересчет стоимости*
    - Кнопка **Оформить заказ**
3. Клиент нажимает на кнопку **Оформить заказ**:
  * Окно для ввода Телефона (*по умолчанию берется из карточки клиента*)
  * Адрес доставки (*можно изменить*)
  * Время доставки (*расчет на стороне сервера*)
  * Выбор способа оплаты:
    - Google Pay/Apple Pay (*перенаправление на страницу оплаты с использованием данных сервисов*)
    - Картой курьеру
    - Картой в приложении (*выбор определенной карты из списка Карты для оплаты + возможность [добавить новую карту](https://knutpig-test.atlassian.net/wiki/spaces/TESTPIZZAN/pages/33368 "Добавление новой карты")*)
  * Итоговая сумма к оплате
4. После выбора клиентом Картой в приложении или Google Pay/Apple Pay необходимо поверить, что платеж прошел 
  * Если платеж прошел, то сохранить Заказ в БД и проставить ему статус *Готовится*
  * Если платеж не прошел, то сохранить Заказ в БД и проставить ему статус *Ожидание оплаты* и вывести соответствующее сообщение пользователю, чтобы он мог пополнить баланс выбранной карты или изменить карту для оплаты, либо отменить заказ
    - После действий пользователя и подтверждения платежа изменить статус заказа на *Готовится*
    - Если пользователь отменил заказ, то проставить статус заказу *ОТМЕНА*
5. Если клиент выбрал опцию Картой курьеру, то необходимо сохранить Заказ в БД и проставить ему статус *Готовится*
6. В случае успешного сохранения Заказа вывести на экран сообщение клиенту, что *Ваш заказ принят в работу, для отслеживания статуса Вашего заказа укажите номер телефона и нажмите подтвердить*, в случае указания (добавить данную информацию в карточку клиента, чтобы в дальнейшем автоматически проставлять данный номер телефона, если он отсутствовал ранее у клиента) и у Заказа проставить флаг Отслеживание статуса = true.
7. При переходе Заказа по статусам необходимо отправлять СМС оповещение клиенту по указанному номеру телефона с текущим статусом заказа.
8. The После этого работа с данным сценарием завершена.



